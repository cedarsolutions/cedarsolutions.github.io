<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>CedarBackup3.extend.subversion &#8212; Cedar Backup v3  documentation</title>
    
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="top" title="Cedar Backup v3  documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Cedar Backup v3  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for CedarBackup3.extend.subversion</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: iso-8859-1 -*-</span>
<span class="c1"># vim: set ft=python ts=3 sw=3 expandtab:</span>
<span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>
<span class="c1">#</span>
<span class="c1">#              C E D A R</span>
<span class="c1">#          S O L U T I O N S       &quot;Software done right.&quot;</span>
<span class="c1">#           S O F T W A R E</span>
<span class="c1">#</span>
<span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>
<span class="c1">#</span>
<span class="c1"># Copyright (c) 2005,2007,2010,2015 Kenneth J. Pronovici.</span>
<span class="c1"># All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># This program is free software; you can redistribute it and/or</span>
<span class="c1"># modify it under the terms of the GNU General Public License,</span>
<span class="c1"># Version 2, as published by the Free Software Foundation.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
<span class="c1">#</span>
<span class="c1"># Copies of the GNU General Public License are available from</span>
<span class="c1"># the Free Software Foundation website, http://www.gnu.org/.</span>
<span class="c1">#</span>
<span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>
<span class="c1">#</span>
<span class="c1"># Author   : Kenneth J. Pronovici &lt;pronovic@ieee.org&gt;</span>
<span class="c1"># Language : Python 3 (&gt;= 3.4)</span>
<span class="c1"># Project  : Official Cedar Backup Extensions</span>
<span class="c1"># Purpose  : Provides an extension to back up Subversion repositories.</span>
<span class="c1">#</span>
<span class="c1"># # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

<span class="c1">########################################################################</span>
<span class="c1"># Module documentation</span>
<span class="c1">########################################################################</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Provides an extension to back up Subversion repositories.</span>

<span class="sd">This is a Cedar Backup extension used to back up Subversion repositories via</span>
<span class="sd">the Cedar Backup command line.  Each Subversion repository can be backed using</span>
<span class="sd">the same collect modes allowed for filesystems in the standard Cedar Backup</span>
<span class="sd">collect action: weekly, daily, incremental.</span>

<span class="sd">This extension requires a new configuration section &lt;subversion&gt; and is</span>
<span class="sd">intended to be run either immediately before or immediately after the standard</span>
<span class="sd">collect action.  Aside from its own configuration, it requires the options and</span>
<span class="sd">collect configuration sections in the standard Cedar Backup configuration file.</span>

<span class="sd">There are two different kinds of Subversion repositories at this writing: BDB</span>
<span class="sd">(Berkeley Database) and FSFS (a &quot;filesystem within a filesystem&quot;).  Although</span>
<span class="sd">the repository type can be specified in configuration, that information is just</span>
<span class="sd">kept around for reference.  It doesn&#39;t affect the backup.  Both kinds of</span>
<span class="sd">repositories are backed up in the same way, using ``svnadmin dump`` in an</span>
<span class="sd">incremental mode.</span>

<span class="sd">It turns out that FSFS repositories can also be backed up just like any</span>
<span class="sd">other filesystem directory.  If you would rather do that, then use the normal</span>
<span class="sd">collect action.  This is probably simpler, although it carries its own</span>
<span class="sd">advantages and disadvantages (plus you will have to be careful to exclude</span>
<span class="sd">the working directories Subversion uses when building an update to commit).</span>
<span class="sd">Check the Subversion documentation for more information.</span>

<span class="sd">:author: Kenneth J. Pronovici &lt;pronovic@ieee.org&gt;</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">########################################################################</span>
<span class="c1"># Imported modules</span>
<span class="c1">########################################################################</span>

<span class="c1"># System modules</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">bz2</span> <span class="k">import</span> <span class="n">BZ2File</span>
<span class="kn">from</span> <span class="nn">gzip</span> <span class="k">import</span> <span class="n">GzipFile</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">total_ordering</span>

<span class="c1"># Cedar Backup modules</span>
<span class="kn">from</span> <span class="nn">CedarBackup3.xmlutil</span> <span class="k">import</span> <span class="n">createInputDom</span><span class="p">,</span> <span class="n">addContainerNode</span><span class="p">,</span> <span class="n">addStringNode</span>
<span class="kn">from</span> <span class="nn">CedarBackup3.xmlutil</span> <span class="k">import</span> <span class="n">isElement</span><span class="p">,</span> <span class="n">readChildren</span><span class="p">,</span> <span class="n">readFirstChild</span><span class="p">,</span> <span class="n">readString</span><span class="p">,</span> <span class="n">readStringList</span>
<span class="kn">from</span> <span class="nn">CedarBackup3.config</span> <span class="k">import</span> <span class="n">VALID_COLLECT_MODES</span><span class="p">,</span> <span class="n">VALID_COMPRESS_MODES</span>
<span class="kn">from</span> <span class="nn">CedarBackup3.filesystem</span> <span class="k">import</span> <span class="n">FilesystemList</span>
<span class="kn">from</span> <span class="nn">CedarBackup3.util</span> <span class="k">import</span> <span class="n">UnorderedList</span><span class="p">,</span> <span class="n">RegexList</span>
<span class="kn">from</span> <span class="nn">CedarBackup3.util</span> <span class="k">import</span> <span class="n">isStartOfWeek</span><span class="p">,</span> <span class="n">buildNormalizedPath</span>
<span class="kn">from</span> <span class="nn">CedarBackup3.util</span> <span class="k">import</span> <span class="n">resolveCommand</span><span class="p">,</span> <span class="n">executeCommand</span>
<span class="kn">from</span> <span class="nn">CedarBackup3.util</span> <span class="k">import</span> <span class="n">ObjectTypeList</span><span class="p">,</span> <span class="n">encodePath</span><span class="p">,</span> <span class="n">changeOwnership</span>


<span class="c1">########################################################################</span>
<span class="c1"># Module-wide constants and variables</span>
<span class="c1">########################################################################</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;CedarBackup3.log.extend.subversion&quot;</span><span class="p">)</span>

<span class="n">SVNLOOK_COMMAND</span>      <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;svnlook&quot;</span><span class="p">,</span> <span class="p">]</span>
<span class="n">SVNADMIN_COMMAND</span>     <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;svnadmin&quot;</span><span class="p">,</span> <span class="p">]</span>

<span class="n">REVISION_PATH_EXTENSION</span> <span class="o">=</span> <span class="s2">&quot;svnlast&quot;</span>


<span class="c1">########################################################################</span>
<span class="c1"># RepositoryDir class definition</span>
<span class="c1">########################################################################</span>

<span class="nd">@total_ordering</span>
<div class="viewcode-block" id="RepositoryDir"><a class="viewcode-back" href="../../../CedarBackup3.extend.html#CedarBackup3.extend.subversion.RepositoryDir">[docs]</a><span class="k">class</span> <span class="nc">RepositoryDir</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Class representing Subversion repository directory.</span>

<span class="sd">   A repository directory is a directory that contains one or more Subversion</span>
<span class="sd">   repositories.</span>

<span class="sd">   The following restrictions exist on data in this class:</span>

<span class="sd">      - The directory path must be absolute.</span>
<span class="sd">      - The collect mode must be one of the values in :any:`VALID_COLLECT_MODES`.</span>
<span class="sd">      - The compress mode must be one of the values in :any:`VALID_COMPRESS_MODES`.</span>

<span class="sd">   The repository type value is kept around just for reference.  It doesn&#39;t</span>
<span class="sd">   affect the behavior of the backup.</span>

<span class="sd">   Relative exclusions are allowed here.  However, there is no configured</span>
<span class="sd">   ignore file, because repository dir backups are not recursive.</span>

<span class="sd">   &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RepositoryDir.__init__"><a class="viewcode-back" href="../../../CedarBackup3.extend.html#CedarBackup3.extend.subversion.RepositoryDir.__init__">[docs]</a>   <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repositoryType</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">directoryPath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">collectMode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compressMode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">relativeExcludePaths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">excludePatterns</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Constructor for the ``RepositoryDir`` class.</span>

<span class="sd">      Args:</span>
<span class="sd">         repositoryType: Type of repository, for reference</span>
<span class="sd">         directoryPath: Absolute path of the Subversion parent directory</span>
<span class="sd">         collectMode: Overridden collect mode for this directory</span>
<span class="sd">         compressMode: Overridden compression mode for this directory</span>
<span class="sd">         relativeExcludePaths: List of relative paths to exclude</span>
<span class="sd">         excludePatterns: List of regular expression patterns to exclude</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_repositoryType</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_directoryPath</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_collectMode</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_compressMode</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_relativeExcludePaths</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_excludePatterns</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">repositoryType</span> <span class="o">=</span> <span class="n">repositoryType</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">directoryPath</span> <span class="o">=</span> <span class="n">directoryPath</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">collectMode</span> <span class="o">=</span> <span class="n">collectMode</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">compressMode</span> <span class="o">=</span> <span class="n">compressMode</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">relativeExcludePaths</span> <span class="o">=</span> <span class="n">relativeExcludePaths</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">excludePatterns</span> <span class="o">=</span> <span class="n">excludePatterns</span></div>

   <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Official string representation for class instance.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="s2">&quot;RepositoryDir(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repositoryType</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">directoryPath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectMode</span><span class="p">,</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">compressMode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">relativeExcludePaths</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">excludePatterns</span><span class="p">)</span>

   <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Informal string representation for class instance.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>

   <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;Equals operator, iplemented in terms of original Python 2 compare operator.&quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

   <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;Less-than operator, iplemented in terms of original Python 2 compare operator.&quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span>

   <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;Greater-than operator, iplemented in terms of original Python 2 compare operator.&quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

   <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Original Python 2 comparison operator.</span>
<span class="sd">      Args:</span>
<span class="sd">         other: Other object to compare to</span>
<span class="sd">      Returns:</span>
<span class="sd">          -1/0/1 depending on whether self is ``&lt;``, ``=`` or ``&gt;`` other</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
         <span class="k">return</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">repositoryType</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">repositoryType</span><span class="p">:</span>
         <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repositoryType</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">repositoryType</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">directoryPath</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">directoryPath</span><span class="p">:</span>
         <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directoryPath</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">directoryPath</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectMode</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">collectMode</span><span class="p">:</span>
         <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collectMode</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">collectMode</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compressMode</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">compressMode</span><span class="p">:</span>
         <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">compressMode</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">compressMode</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">relativeExcludePaths</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">relativeExcludePaths</span><span class="p">:</span>
         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">relativeExcludePaths</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">relativeExcludePaths</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">excludePatterns</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">excludePatterns</span><span class="p">:</span>
         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">excludePatterns</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">excludePatterns</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
      <span class="k">return</span> <span class="mi">0</span>

   <span class="k">def</span> <span class="nf">_setRepositoryType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to set the repository type.</span>
<span class="sd">      There is no validation; this value is kept around just for reference.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_repositoryType</span> <span class="o">=</span> <span class="n">value</span>

   <span class="k">def</span> <span class="nf">_getRepositoryType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to get the repository type.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repositoryType</span>

   <span class="k">def</span> <span class="nf">_setDirectoryPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to set the directory path.</span>
<span class="sd">      The value must be an absolute path if it is not ``None``.</span>
<span class="sd">      It does not have to exist on disk at the time of assignment.</span>
<span class="sd">      Raises:</span>
<span class="sd">         ValueError: If the value is not an absolute path</span>
<span class="sd">         ValueError: If the value cannot be encoded properly</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
         <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Repository path must be an absolute path.&quot;</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_directoryPath</span> <span class="o">=</span> <span class="n">encodePath</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

   <span class="k">def</span> <span class="nf">_getDirectoryPath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to get the repository path.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directoryPath</span>

   <span class="k">def</span> <span class="nf">_setCollectMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to set the collect mode.</span>
<span class="sd">      If not ``None``, the mode must be one of the values in :any:`VALID_COLLECT_MODES`.</span>
<span class="sd">      Raises:</span>
<span class="sd">         ValueError: If the value is not valid</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VALID_COLLECT_MODES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Collect mode must be one of </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">VALID_COLLECT_MODES</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_collectMode</span> <span class="o">=</span> <span class="n">value</span>

   <span class="k">def</span> <span class="nf">_getCollectMode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to get the collect mode.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collectMode</span>

   <span class="k">def</span> <span class="nf">_setCompressMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to set the compress mode.</span>
<span class="sd">      If not ``None``, the mode must be one of the values in :any:`VALID_COMPRESS_MODES`.</span>
<span class="sd">      Raises:</span>
<span class="sd">         ValueError: If the value is not valid</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VALID_COMPRESS_MODES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Compress mode must be one of </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">VALID_COMPRESS_MODES</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_compressMode</span> <span class="o">=</span> <span class="n">value</span>

   <span class="k">def</span> <span class="nf">_getCompressMode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to get the compress mode.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compressMode</span>

   <span class="k">def</span> <span class="nf">_setRelativeExcludePaths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to set the relative exclude paths list.</span>
<span class="sd">      Elements do not have to exist on disk at the time of assignment.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">_relativeExcludePaths</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="k">try</span><span class="p">:</span>
            <span class="n">saved</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_relativeExcludePaths</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_relativeExcludePaths</span> <span class="o">=</span> <span class="n">UnorderedList</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_relativeExcludePaths</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
         <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_relativeExcludePaths</span> <span class="o">=</span> <span class="n">saved</span>
            <span class="k">raise</span> <span class="n">e</span>

   <span class="k">def</span> <span class="nf">_getRelativeExcludePaths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to get the relative exclude paths list.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_relativeExcludePaths</span>

   <span class="k">def</span> <span class="nf">_setExcludePatterns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to set the exclude patterns list.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">_excludePatterns</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="k">try</span><span class="p">:</span>
            <span class="n">saved</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_excludePatterns</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_excludePatterns</span> <span class="o">=</span> <span class="n">RegexList</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_excludePatterns</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
         <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_excludePatterns</span> <span class="o">=</span> <span class="n">saved</span>
            <span class="k">raise</span> <span class="n">e</span>

   <span class="k">def</span> <span class="nf">_getExcludePatterns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to get the exclude patterns list.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_excludePatterns</span>

   <span class="n">repositoryType</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getRepositoryType</span><span class="p">,</span> <span class="n">_setRepositoryType</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Type of this repository, for reference.&quot;</span><span class="p">)</span>
   <span class="n">directoryPath</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getDirectoryPath</span><span class="p">,</span> <span class="n">_setDirectoryPath</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Absolute path of the Subversion parent directory.&quot;</span><span class="p">)</span>
   <span class="n">collectMode</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getCollectMode</span><span class="p">,</span> <span class="n">_setCollectMode</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Overridden collect mode for this repository.&quot;</span><span class="p">)</span>
   <span class="n">compressMode</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getCompressMode</span><span class="p">,</span> <span class="n">_setCompressMode</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Overridden compress mode for this repository.&quot;</span><span class="p">)</span>
   <span class="n">relativeExcludePaths</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getRelativeExcludePaths</span><span class="p">,</span> <span class="n">_setRelativeExcludePaths</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;List of relative paths to exclude.&quot;</span><span class="p">)</span>
   <span class="n">excludePatterns</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getExcludePatterns</span><span class="p">,</span> <span class="n">_setExcludePatterns</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;List of regular expression patterns to exclude.&quot;</span><span class="p">)</span></div>


<span class="c1">########################################################################</span>
<span class="c1"># Repository class definition</span>
<span class="c1">########################################################################</span>

<span class="nd">@total_ordering</span>
<div class="viewcode-block" id="Repository"><a class="viewcode-back" href="../../../CedarBackup3.extend.html#CedarBackup3.extend.subversion.Repository">[docs]</a><span class="k">class</span> <span class="nc">Repository</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Class representing generic Subversion repository configuration..</span>

<span class="sd">   The following restrictions exist on data in this class:</span>

<span class="sd">      - The respository path must be absolute.</span>
<span class="sd">      - The collect mode must be one of the values in :any:`VALID_COLLECT_MODES`.</span>
<span class="sd">      - The compress mode must be one of the values in :any:`VALID_COMPRESS_MODES`.</span>

<span class="sd">   The repository type value is kept around just for reference.  It doesn&#39;t</span>
<span class="sd">   affect the behavior of the backup.</span>

<span class="sd">   &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Repository.__init__"><a class="viewcode-back" href="../../../CedarBackup3.extend.html#CedarBackup3.extend.subversion.Repository.__init__">[docs]</a>   <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repositoryType</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">repositoryPath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">collectMode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compressMode</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Constructor for the ``Repository`` class.</span>

<span class="sd">      Args:</span>
<span class="sd">         repositoryType: Type of repository, for reference</span>
<span class="sd">         repositoryPath: Absolute path to a Subversion repository on disk</span>
<span class="sd">         collectMode: Overridden collect mode for this directory</span>
<span class="sd">         compressMode: Overridden compression mode for this directory</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_repositoryType</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_repositoryPath</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_collectMode</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_compressMode</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">repositoryType</span> <span class="o">=</span> <span class="n">repositoryType</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">repositoryPath</span> <span class="o">=</span> <span class="n">repositoryPath</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">collectMode</span> <span class="o">=</span> <span class="n">collectMode</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">compressMode</span> <span class="o">=</span> <span class="n">compressMode</span></div>

   <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Official string representation for class instance.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="s2">&quot;Repository(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repositoryType</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">repositoryPath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectMode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compressMode</span><span class="p">)</span>

   <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Informal string representation for class instance.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>

   <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;Equals operator, iplemented in terms of original Python 2 compare operator.&quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

   <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;Less-than operator, iplemented in terms of original Python 2 compare operator.&quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span>

   <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;Greater-than operator, iplemented in terms of original Python 2 compare operator.&quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

   <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Original Python 2 comparison operator.</span>
<span class="sd">      Args:</span>
<span class="sd">         other: Other object to compare to</span>
<span class="sd">      Returns:</span>
<span class="sd">          -1/0/1 depending on whether self is ``&lt;``, ``=`` or ``&gt;`` other</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
         <span class="k">return</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">repositoryType</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">repositoryType</span><span class="p">:</span>
         <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repositoryType</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">repositoryType</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">repositoryPath</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">repositoryPath</span><span class="p">:</span>
         <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repositoryPath</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">repositoryPath</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectMode</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">collectMode</span><span class="p">:</span>
         <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collectMode</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">collectMode</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compressMode</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">compressMode</span><span class="p">:</span>
         <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">compressMode</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">compressMode</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
      <span class="k">return</span> <span class="mi">0</span>

   <span class="k">def</span> <span class="nf">_setRepositoryType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to set the repository type.</span>
<span class="sd">      There is no validation; this value is kept around just for reference.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_repositoryType</span> <span class="o">=</span> <span class="n">value</span>

   <span class="k">def</span> <span class="nf">_getRepositoryType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to get the repository type.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repositoryType</span>

   <span class="k">def</span> <span class="nf">_setRepositoryPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to set the repository path.</span>
<span class="sd">      The value must be an absolute path if it is not ``None``.</span>
<span class="sd">      It does not have to exist on disk at the time of assignment.</span>
<span class="sd">      Raises:</span>
<span class="sd">         ValueError: If the value is not an absolute path</span>
<span class="sd">         ValueError: If the value cannot be encoded properly</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
         <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Repository path must be an absolute path.&quot;</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_repositoryPath</span> <span class="o">=</span> <span class="n">encodePath</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

   <span class="k">def</span> <span class="nf">_getRepositoryPath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to get the repository path.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repositoryPath</span>

   <span class="k">def</span> <span class="nf">_setCollectMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to set the collect mode.</span>
<span class="sd">      If not ``None``, the mode must be one of the values in :any:`VALID_COLLECT_MODES`.</span>
<span class="sd">      Raises:</span>
<span class="sd">         ValueError: If the value is not valid</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VALID_COLLECT_MODES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Collect mode must be one of </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">VALID_COLLECT_MODES</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_collectMode</span> <span class="o">=</span> <span class="n">value</span>

   <span class="k">def</span> <span class="nf">_getCollectMode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to get the collect mode.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collectMode</span>

   <span class="k">def</span> <span class="nf">_setCompressMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to set the compress mode.</span>
<span class="sd">      If not ``None``, the mode must be one of the values in :any:`VALID_COMPRESS_MODES`.</span>
<span class="sd">      Raises:</span>
<span class="sd">         ValueError: If the value is not valid</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VALID_COMPRESS_MODES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Compress mode must be one of </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">VALID_COMPRESS_MODES</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_compressMode</span> <span class="o">=</span> <span class="n">value</span>

   <span class="k">def</span> <span class="nf">_getCompressMode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to get the compress mode.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compressMode</span>

   <span class="n">repositoryType</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getRepositoryType</span><span class="p">,</span> <span class="n">_setRepositoryType</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Type of this repository, for reference.&quot;</span><span class="p">)</span>
   <span class="n">repositoryPath</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getRepositoryPath</span><span class="p">,</span> <span class="n">_setRepositoryPath</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Path to the repository to collect.&quot;</span><span class="p">)</span>
   <span class="n">collectMode</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getCollectMode</span><span class="p">,</span> <span class="n">_setCollectMode</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Overridden collect mode for this repository.&quot;</span><span class="p">)</span>
   <span class="n">compressMode</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getCompressMode</span><span class="p">,</span> <span class="n">_setCompressMode</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Overridden compress mode for this repository.&quot;</span><span class="p">)</span></div>


<span class="c1">########################################################################</span>
<span class="c1"># SubversionConfig class definition</span>
<span class="c1">########################################################################</span>

<span class="nd">@total_ordering</span>
<div class="viewcode-block" id="SubversionConfig"><a class="viewcode-back" href="../../../CedarBackup3.extend.html#CedarBackup3.extend.subversion.SubversionConfig">[docs]</a><span class="k">class</span> <span class="nc">SubversionConfig</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Class representing Subversion configuration.</span>

<span class="sd">   Subversion configuration is used for backing up Subversion repositories.</span>

<span class="sd">   The following restrictions exist on data in this class:</span>

<span class="sd">      - The collect mode must be one of the values in :any:`VALID_COLLECT_MODES`.</span>
<span class="sd">      - The compress mode must be one of the values in :any:`VALID_COMPRESS_MODES`.</span>
<span class="sd">      - The repositories list must be a list of ``Repository`` objects.</span>
<span class="sd">      - The repositoryDirs list must be a list of ``RepositoryDir`` objects.</span>

<span class="sd">   For the two lists, validation is accomplished through the</span>
<span class="sd">   :any:`util.ObjectTypeList` list implementation that overrides common list</span>
<span class="sd">   methods and transparently ensures that each element has the correct type.</span>

<span class="sd">   *Note:* Lists within this class are &quot;unordered&quot; for equality comparisons.</span>

<span class="sd">   &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SubversionConfig.__init__"><a class="viewcode-back" href="../../../CedarBackup3.extend.html#CedarBackup3.extend.subversion.SubversionConfig.__init__">[docs]</a>   <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collectMode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compressMode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">repositories</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">repositoryDirs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Constructor for the ``SubversionConfig`` class.</span>

<span class="sd">      Args:</span>
<span class="sd">         collectMode: Default collect mode</span>
<span class="sd">         compressMode: Default compress mode</span>
<span class="sd">         repositories: List of Subversion repositories to back up</span>
<span class="sd">         repositoryDirs: List of Subversion parent directories to back up</span>

<span class="sd">      Raises:</span>
<span class="sd">         ValueError: If one of the values is invalid</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_collectMode</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_compressMode</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_repositories</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_repositoryDirs</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">collectMode</span> <span class="o">=</span> <span class="n">collectMode</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">compressMode</span> <span class="o">=</span> <span class="n">compressMode</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">repositories</span> <span class="o">=</span> <span class="n">repositories</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">repositoryDirs</span> <span class="o">=</span> <span class="n">repositoryDirs</span></div>

   <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Official string representation for class instance.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="s2">&quot;SubversionConfig(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collectMode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compressMode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">repositories</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">repositoryDirs</span><span class="p">)</span>

   <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Informal string representation for class instance.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>

   <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;Equals operator, iplemented in terms of original Python 2 compare operator.&quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

   <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;Less-than operator, iplemented in terms of original Python 2 compare operator.&quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span>

   <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;Greater-than operator, iplemented in terms of original Python 2 compare operator.&quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

   <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Original Python 2 comparison operator.</span>
<span class="sd">      Lists within this class are &quot;unordered&quot; for equality comparisons.</span>
<span class="sd">      Args:</span>
<span class="sd">         other: Other object to compare to</span>
<span class="sd">      Returns:</span>
<span class="sd">          -1/0/1 depending on whether self is ``&lt;``, ``=`` or ``&gt;`` other</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
         <span class="k">return</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectMode</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">collectMode</span><span class="p">:</span>
         <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collectMode</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">collectMode</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compressMode</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">compressMode</span><span class="p">:</span>
         <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">compressMode</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">compressMode</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">repositories</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">repositories</span><span class="p">:</span>
         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">repositories</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">repositories</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">repositoryDirs</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">repositoryDirs</span><span class="p">:</span>
         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">repositoryDirs</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">repositoryDirs</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
      <span class="k">return</span> <span class="mi">0</span>

   <span class="k">def</span> <span class="nf">_setCollectMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to set the collect mode.</span>
<span class="sd">      If not ``None``, the mode must be one of the values in :any:`VALID_COLLECT_MODES`.</span>
<span class="sd">      Raises:</span>
<span class="sd">         ValueError: If the value is not valid</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VALID_COLLECT_MODES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Collect mode must be one of </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">VALID_COLLECT_MODES</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_collectMode</span> <span class="o">=</span> <span class="n">value</span>

   <span class="k">def</span> <span class="nf">_getCollectMode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to get the collect mode.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collectMode</span>

   <span class="k">def</span> <span class="nf">_setCompressMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to set the compress mode.</span>
<span class="sd">      If not ``None``, the mode must be one of the values in :any:`VALID_COMPRESS_MODES`.</span>
<span class="sd">      Raises:</span>
<span class="sd">         ValueError: If the value is not valid</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VALID_COMPRESS_MODES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Compress mode must be one of </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">VALID_COMPRESS_MODES</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_compressMode</span> <span class="o">=</span> <span class="n">value</span>

   <span class="k">def</span> <span class="nf">_getCompressMode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to get the compress mode.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compressMode</span>

   <span class="k">def</span> <span class="nf">_setRepositories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to set the repositories list.</span>
<span class="sd">      Either the value must be ``None`` or each element must be a ``Repository``.</span>
<span class="sd">      Raises:</span>
<span class="sd">         ValueError: If the value is not a ``Repository``</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">_repositories</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="k">try</span><span class="p">:</span>
            <span class="n">saved</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repositories</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_repositories</span> <span class="o">=</span> <span class="n">ObjectTypeList</span><span class="p">(</span><span class="n">Repository</span><span class="p">,</span> <span class="s2">&quot;Repository&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_repositories</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
         <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_repositories</span> <span class="o">=</span> <span class="n">saved</span>
            <span class="k">raise</span> <span class="n">e</span>

   <span class="k">def</span> <span class="nf">_getRepositories</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to get the repositories list.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repositories</span>

   <span class="k">def</span> <span class="nf">_setRepositoryDirs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to set the repositoryDirs list.</span>
<span class="sd">      Either the value must be ``None`` or each element must be a ``Repository``.</span>
<span class="sd">      Raises:</span>
<span class="sd">         ValueError: If the value is not a ``Repository``</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">_repositoryDirs</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="k">try</span><span class="p">:</span>
            <span class="n">saved</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repositoryDirs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_repositoryDirs</span> <span class="o">=</span> <span class="n">ObjectTypeList</span><span class="p">(</span><span class="n">RepositoryDir</span><span class="p">,</span> <span class="s2">&quot;RepositoryDir&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_repositoryDirs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
         <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_repositoryDirs</span> <span class="o">=</span> <span class="n">saved</span>
            <span class="k">raise</span> <span class="n">e</span>

   <span class="k">def</span> <span class="nf">_getRepositoryDirs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to get the repositoryDirs list.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repositoryDirs</span>

   <span class="n">collectMode</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getCollectMode</span><span class="p">,</span> <span class="n">_setCollectMode</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Default collect mode.&quot;</span><span class="p">)</span>
   <span class="n">compressMode</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getCompressMode</span><span class="p">,</span> <span class="n">_setCompressMode</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Default compress mode.&quot;</span><span class="p">)</span>
   <span class="n">repositories</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getRepositories</span><span class="p">,</span> <span class="n">_setRepositories</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;List of Subversion repositories to back up.&quot;</span><span class="p">)</span>
   <span class="n">repositoryDirs</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getRepositoryDirs</span><span class="p">,</span> <span class="n">_setRepositoryDirs</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;List of Subversion parent directories to back up.&quot;</span><span class="p">)</span></div>


<span class="c1">########################################################################</span>
<span class="c1"># LocalConfig class definition</span>
<span class="c1">########################################################################</span>

<span class="nd">@total_ordering</span>
<div class="viewcode-block" id="LocalConfig"><a class="viewcode-back" href="../../../CedarBackup3.extend.html#CedarBackup3.extend.subversion.LocalConfig">[docs]</a><span class="k">class</span> <span class="nc">LocalConfig</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Class representing this extension&#39;s configuration document.</span>

<span class="sd">   This is not a general-purpose configuration object like the main Cedar</span>
<span class="sd">   Backup configuration object.  Instead, it just knows how to parse and emit</span>
<span class="sd">   Subversion-specific configuration values.  Third parties who need to read</span>
<span class="sd">   and write configuration related to this extension should access it through</span>
<span class="sd">   the constructor, ``validate`` and ``addConfig`` methods.</span>

<span class="sd">   *Note:* Lists within this class are &quot;unordered&quot; for equality comparisons.</span>

<span class="sd">   &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LocalConfig.__init__"><a class="viewcode-back" href="../../../CedarBackup3.extend.html#CedarBackup3.extend.subversion.LocalConfig.__init__">[docs]</a>   <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmlData</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xmlPath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Initializes a configuration object.</span>

<span class="sd">      If you initialize the object without passing either ``xmlData`` or</span>
<span class="sd">      ``xmlPath`` then configuration will be empty and will be invalid until it</span>
<span class="sd">      is filled in properly.</span>

<span class="sd">      No reference to the original XML data or original path is saved off by</span>
<span class="sd">      this class.  Once the data has been parsed (successfully or not) this</span>
<span class="sd">      original information is discarded.</span>

<span class="sd">      Unless the ``validate`` argument is ``False``, the :any:`LocalConfig.validate`</span>
<span class="sd">      method will be called (with its default arguments) against configuration</span>
<span class="sd">      after successfully parsing any passed-in XML.  Keep in mind that even if</span>
<span class="sd">      ``validate`` is ``False``, it might not be possible to parse the passed-in</span>
<span class="sd">      XML document if lower-level validations fail.</span>

<span class="sd">      *Note:* It is strongly suggested that the ``validate`` option always be set</span>
<span class="sd">      to ``True`` (the default) unless there is a specific need to read in</span>
<span class="sd">      invalid configuration from disk.</span>

<span class="sd">      Args:</span>
<span class="sd">         xmlData (String data): XML data representing configuration</span>
<span class="sd">         xmlPath (Absolute path to a file on disk): Path to an XML file on disk</span>
<span class="sd">         validate (Boolean true/false): Validate the document after parsing it</span>
<span class="sd">      Raises:</span>
<span class="sd">         ValueError: If both ``xmlData`` and ``xmlPath`` are passed-in</span>
<span class="sd">         ValueError: If the XML data in ``xmlData`` or ``xmlPath`` cannot be parsed</span>
<span class="sd">         ValueError: If the parsed configuration document is not valid</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_subversion</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">subversion</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">if</span> <span class="n">xmlData</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">xmlPath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Use either xmlData or xmlPath, but not both.&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">xmlData</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">_parseXmlData</span><span class="p">(</span><span class="n">xmlData</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
      <span class="k">elif</span> <span class="n">xmlPath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
         <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">xmlPath</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">xmlData</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">_parseXmlData</span><span class="p">(</span><span class="n">xmlData</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span></div>

   <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Official string representation for class instance.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="s2">&quot;LocalConfig(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subversion</span><span class="p">)</span>

   <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Informal string representation for class instance.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>

   <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;Equals operator, iplemented in terms of original Python 2 compare operator.&quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

   <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;Less-than operator, iplemented in terms of original Python 2 compare operator.&quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span>

   <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;Greater-than operator, iplemented in terms of original Python 2 compare operator.&quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

   <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Original Python 2 comparison operator.</span>
<span class="sd">      Lists within this class are &quot;unordered&quot; for equality comparisons.</span>
<span class="sd">      Args:</span>
<span class="sd">         other: Other object to compare to</span>
<span class="sd">      Returns:</span>
<span class="sd">          -1/0/1 depending on whether self is ``&lt;``, ``=`` or ``&gt;`` other</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
         <span class="k">return</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subversion</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">subversion</span><span class="p">:</span>
         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subversion</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">subversion</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
      <span class="k">return</span> <span class="mi">0</span>

   <span class="k">def</span> <span class="nf">_setSubversion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to set the subversion configuration value.</span>
<span class="sd">      If not ``None``, the value must be a ``SubversionConfig`` object.</span>
<span class="sd">      Raises:</span>
<span class="sd">         ValueError: If the value is not a ``SubversionConfig``</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">_subversion</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">SubversionConfig</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Value must be a ``SubversionConfig`` object.&quot;</span><span class="p">)</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">_subversion</span> <span class="o">=</span> <span class="n">value</span>

   <span class="k">def</span> <span class="nf">_getSubversion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Property target used to get the subversion configuration value.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subversion</span>

   <span class="n">subversion</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getSubversion</span><span class="p">,</span> <span class="n">_setSubversion</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Subversion configuration in terms of a ``SubversionConfig`` object.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="LocalConfig.validate"><a class="viewcode-back" href="../../../CedarBackup3.extend.html#CedarBackup3.extend.subversion.LocalConfig.validate">[docs]</a>   <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Validates configuration represented by the object.</span>

<span class="sd">      Subversion configuration must be filled in.  Within that, the collect</span>
<span class="sd">      mode and compress mode are both optional, but the list of repositories</span>
<span class="sd">      must contain at least one entry.</span>

<span class="sd">      Each repository must contain a repository path, and then must be either</span>
<span class="sd">      able to take collect mode and compress mode configuration from the parent</span>
<span class="sd">      ``SubversionConfig`` object, or must set each value on its own.</span>

<span class="sd">      Raises:</span>
<span class="sd">         ValueError: If one of the validations fails</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Subversion section is required.&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">repositories</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">repositories</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span>
          <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">repositoryDirs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">repositoryDirs</span><span class="p">)</span> <span class="o">&lt;</span><span class="mi">1</span><span class="p">)):</span>
         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one Subversion repository must be configured.&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">repositories</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
         <span class="k">for</span> <span class="n">repository</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">repositories</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">repository</span><span class="o">.</span><span class="n">repositoryPath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
               <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Each repository must set a repository path.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">collectMode</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">repository</span><span class="o">.</span><span class="n">collectMode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
               <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Collect mode must either be set in parent section or individual repository.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">compressMode</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">repository</span><span class="o">.</span><span class="n">compressMode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
               <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Compress mode must either be set in parent section or individual repository.&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">repositoryDirs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
         <span class="k">for</span> <span class="n">repositoryDir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">repositoryDirs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">repositoryDir</span><span class="o">.</span><span class="n">directoryPath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
               <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Each repository directory must set a directory path.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">collectMode</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">repositoryDir</span><span class="o">.</span><span class="n">collectMode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
               <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Collect mode must either be set in parent section or repository directory.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">compressMode</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">repositoryDir</span><span class="o">.</span><span class="n">compressMode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
               <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Compress mode must either be set in parent section or repository directory.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="LocalConfig.addConfig"><a class="viewcode-back" href="../../../CedarBackup3.extend.html#CedarBackup3.extend.subversion.LocalConfig.addConfig">[docs]</a>   <span class="k">def</span> <span class="nf">addConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmlDom</span><span class="p">,</span> <span class="n">parentNode</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Adds a &lt;subversion&gt; configuration section as the next child of a parent.</span>

<span class="sd">      Third parties should use this function to write configuration related to</span>
<span class="sd">      this extension.</span>

<span class="sd">      We add the following fields to the document::</span>

<span class="sd">         collectMode    //cb_config/subversion/collectMode</span>
<span class="sd">         compressMode   //cb_config/subversion/compressMode</span>

<span class="sd">      We also add groups of the following items, one list element per</span>
<span class="sd">      item::</span>

<span class="sd">         repository     //cb_config/subversion/repository</span>
<span class="sd">         repository_dir //cb_config/subversion/repository_dir</span>

<span class="sd">      Args:</span>
<span class="sd">         xmlDom: DOM tree as from ``impl.createDocument()``</span>
<span class="sd">         parentNode: Parent that the section should be appended to</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subversion</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
         <span class="n">sectionNode</span> <span class="o">=</span> <span class="n">addContainerNode</span><span class="p">(</span><span class="n">xmlDom</span><span class="p">,</span> <span class="n">parentNode</span><span class="p">,</span> <span class="s2">&quot;subversion&quot;</span><span class="p">)</span>
         <span class="n">addStringNode</span><span class="p">(</span><span class="n">xmlDom</span><span class="p">,</span> <span class="n">sectionNode</span><span class="p">,</span> <span class="s2">&quot;collect_mode&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">collectMode</span><span class="p">)</span>
         <span class="n">addStringNode</span><span class="p">(</span><span class="n">xmlDom</span><span class="p">,</span> <span class="n">sectionNode</span><span class="p">,</span> <span class="s2">&quot;compress_mode&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">compressMode</span><span class="p">)</span>
         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">repositories</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">repository</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">repositories</span><span class="p">:</span>
               <span class="n">LocalConfig</span><span class="o">.</span><span class="n">_addRepository</span><span class="p">(</span><span class="n">xmlDom</span><span class="p">,</span> <span class="n">sectionNode</span><span class="p">,</span> <span class="n">repository</span><span class="p">)</span>
         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">repositoryDirs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">repositoryDir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">repositoryDirs</span><span class="p">:</span>
               <span class="n">LocalConfig</span><span class="o">.</span><span class="n">_addRepositoryDir</span><span class="p">(</span><span class="n">xmlDom</span><span class="p">,</span> <span class="n">sectionNode</span><span class="p">,</span> <span class="n">repositoryDir</span><span class="p">)</span></div>

   <span class="k">def</span> <span class="nf">_parseXmlData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmlData</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Internal method to parse an XML string into the object.</span>

<span class="sd">      This method parses the XML document into a DOM tree (``xmlDom``) and then</span>
<span class="sd">      calls a static method to parse the subversion configuration section.</span>

<span class="sd">      Args:</span>
<span class="sd">         xmlData (String data): XML data to be parsed</span>
<span class="sd">      Raises:</span>
<span class="sd">         ValueError: If the XML cannot be successfully parsed</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="p">(</span><span class="n">xmlDom</span><span class="p">,</span> <span class="n">parentNode</span><span class="p">)</span> <span class="o">=</span> <span class="n">createInputDom</span><span class="p">(</span><span class="n">xmlData</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_subversion</span> <span class="o">=</span> <span class="n">LocalConfig</span><span class="o">.</span><span class="n">_parseSubversion</span><span class="p">(</span><span class="n">parentNode</span><span class="p">)</span>

   <span class="nd">@staticmethod</span>
   <span class="k">def</span> <span class="nf">_parseSubversion</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Parses a subversion configuration section.</span>

<span class="sd">      We read the following individual fields::</span>

<span class="sd">         collectMode    //cb_config/subversion/collect_mode</span>
<span class="sd">         compressMode   //cb_config/subversion/compress_mode</span>

<span class="sd">      We also read groups of the following item, one list element per</span>
<span class="sd">      item::</span>

<span class="sd">         repositories    //cb_config/subversion/repository</span>
<span class="sd">         repository_dirs //cb_config/subversion/repository_dir</span>

<span class="sd">      The repositories are parsed by :any:`_parseRepositories`, and the repository</span>
<span class="sd">      dirs are parsed by :any:`_parseRepositoryDirs`.</span>

<span class="sd">      Args:</span>
<span class="sd">         parent: Parent node to search beneath</span>

<span class="sd">      Returns:</span>
<span class="sd">          ``SubversionConfig`` object or ``None`` if the section does not exist</span>
<span class="sd">      Raises:</span>
<span class="sd">         ValueError: If some filled-in value is invalid</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="n">subversion</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="n">section</span> <span class="o">=</span> <span class="n">readFirstChild</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;subversion&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">section</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
         <span class="n">subversion</span> <span class="o">=</span> <span class="n">SubversionConfig</span><span class="p">()</span>
         <span class="n">subversion</span><span class="o">.</span><span class="n">collectMode</span> <span class="o">=</span> <span class="n">readString</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s2">&quot;collect_mode&quot;</span><span class="p">)</span>
         <span class="n">subversion</span><span class="o">.</span><span class="n">compressMode</span> <span class="o">=</span> <span class="n">readString</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s2">&quot;compress_mode&quot;</span><span class="p">)</span>
         <span class="n">subversion</span><span class="o">.</span><span class="n">repositories</span> <span class="o">=</span> <span class="n">LocalConfig</span><span class="o">.</span><span class="n">_parseRepositories</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
         <span class="n">subversion</span><span class="o">.</span><span class="n">repositoryDirs</span> <span class="o">=</span> <span class="n">LocalConfig</span><span class="o">.</span><span class="n">_parseRepositoryDirs</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">subversion</span>

   <span class="nd">@staticmethod</span>
   <span class="k">def</span> <span class="nf">_parseRepositories</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Reads a list of ``Repository`` objects from immediately beneath the parent.</span>

<span class="sd">      We read the following individual fields::</span>

<span class="sd">         repositoryType          type</span>
<span class="sd">         repositoryPath          abs_path</span>
<span class="sd">         collectMode             collect_mode</span>
<span class="sd">         compressMode            compess_mode</span>

<span class="sd">      The type field is optional, and its value is kept around only for</span>
<span class="sd">      reference.</span>

<span class="sd">      Args:</span>
<span class="sd">         parent: Parent node to search beneath</span>

<span class="sd">      Returns:</span>
<span class="sd">          List of ``Repository`` objects or ``None`` if none are found</span>
<span class="sd">      Raises:</span>
<span class="sd">         ValueError: If some filled-in value is invalid</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">readChildren</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;repository&quot;</span><span class="p">):</span>
         <span class="k">if</span> <span class="n">isElement</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
            <span class="n">repository</span> <span class="o">=</span> <span class="n">Repository</span><span class="p">()</span>
            <span class="n">repository</span><span class="o">.</span><span class="n">repositoryType</span> <span class="o">=</span> <span class="n">readString</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">)</span>
            <span class="n">repository</span><span class="o">.</span><span class="n">repositoryPath</span> <span class="o">=</span> <span class="n">readString</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;abs_path&quot;</span><span class="p">)</span>
            <span class="n">repository</span><span class="o">.</span><span class="n">collectMode</span> <span class="o">=</span> <span class="n">readString</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;collect_mode&quot;</span><span class="p">)</span>
            <span class="n">repository</span><span class="o">.</span><span class="n">compressMode</span> <span class="o">=</span> <span class="n">readString</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;compress_mode&quot;</span><span class="p">)</span>
            <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">repository</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">lst</span> <span class="o">==</span> <span class="p">[]:</span>
         <span class="n">lst</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">return</span> <span class="n">lst</span>

   <span class="nd">@staticmethod</span>
   <span class="k">def</span> <span class="nf">_addRepository</span><span class="p">(</span><span class="n">xmlDom</span><span class="p">,</span> <span class="n">parentNode</span><span class="p">,</span> <span class="n">repository</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Adds a repository container as the next child of a parent.</span>

<span class="sd">      We add the following fields to the document::</span>

<span class="sd">         repositoryType          repository/type</span>
<span class="sd">         repositoryPath          repository/abs_path</span>
<span class="sd">         collectMode             repository/collect_mode</span>
<span class="sd">         compressMode            repository/compress_mode</span>

<span class="sd">      The &lt;repository&gt; node itself is created as the next child of the parent</span>
<span class="sd">      node.  This method only adds one repository node.  The parent must loop</span>
<span class="sd">      for each repository in the ``SubversionConfig`` object.</span>

<span class="sd">      If ``repository`` is ``None``, this method call will be a no-op.</span>

<span class="sd">      Args:</span>
<span class="sd">         xmlDom: DOM tree as from ``impl.createDocument()``</span>
<span class="sd">         parentNode: Parent that the section should be appended to</span>
<span class="sd">         repository: Repository to be added to the document</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="n">repository</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
         <span class="n">sectionNode</span> <span class="o">=</span> <span class="n">addContainerNode</span><span class="p">(</span><span class="n">xmlDom</span><span class="p">,</span> <span class="n">parentNode</span><span class="p">,</span> <span class="s2">&quot;repository&quot;</span><span class="p">)</span>
         <span class="n">addStringNode</span><span class="p">(</span><span class="n">xmlDom</span><span class="p">,</span> <span class="n">sectionNode</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="n">repository</span><span class="o">.</span><span class="n">repositoryType</span><span class="p">)</span>
         <span class="n">addStringNode</span><span class="p">(</span><span class="n">xmlDom</span><span class="p">,</span> <span class="n">sectionNode</span><span class="p">,</span> <span class="s2">&quot;abs_path&quot;</span><span class="p">,</span> <span class="n">repository</span><span class="o">.</span><span class="n">repositoryPath</span><span class="p">)</span>
         <span class="n">addStringNode</span><span class="p">(</span><span class="n">xmlDom</span><span class="p">,</span> <span class="n">sectionNode</span><span class="p">,</span> <span class="s2">&quot;collect_mode&quot;</span><span class="p">,</span> <span class="n">repository</span><span class="o">.</span><span class="n">collectMode</span><span class="p">)</span>
         <span class="n">addStringNode</span><span class="p">(</span><span class="n">xmlDom</span><span class="p">,</span> <span class="n">sectionNode</span><span class="p">,</span> <span class="s2">&quot;compress_mode&quot;</span><span class="p">,</span> <span class="n">repository</span><span class="o">.</span><span class="n">compressMode</span><span class="p">)</span>

   <span class="nd">@staticmethod</span>
   <span class="k">def</span> <span class="nf">_parseRepositoryDirs</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Reads a list of ``RepositoryDir`` objects from immediately beneath the parent.</span>

<span class="sd">      We read the following individual fields::</span>

<span class="sd">         repositoryType          type</span>
<span class="sd">         directoryPath           abs_path</span>
<span class="sd">         collectMode             collect_mode</span>
<span class="sd">         compressMode            compess_mode</span>

<span class="sd">      We also read groups of the following items, one list element per</span>
<span class="sd">      item::</span>

<span class="sd">         relativeExcludePaths    exclude/rel_path</span>
<span class="sd">         excludePatterns         exclude/pattern</span>

<span class="sd">      The exclusions are parsed by :any:`_parseExclusions`.</span>

<span class="sd">      The type field is optional, and its value is kept around only for</span>
<span class="sd">      reference.</span>

<span class="sd">      Args:</span>
<span class="sd">         parent: Parent node to search beneath</span>

<span class="sd">      Returns:</span>
<span class="sd">          List of ``RepositoryDir`` objects or ``None`` if none are found</span>
<span class="sd">      Raises:</span>
<span class="sd">         ValueError: If some filled-in value is invalid</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">readChildren</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;repository_dir&quot;</span><span class="p">):</span>
         <span class="k">if</span> <span class="n">isElement</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
            <span class="n">repositoryDir</span> <span class="o">=</span> <span class="n">RepositoryDir</span><span class="p">()</span>
            <span class="n">repositoryDir</span><span class="o">.</span><span class="n">repositoryType</span> <span class="o">=</span> <span class="n">readString</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">)</span>
            <span class="n">repositoryDir</span><span class="o">.</span><span class="n">directoryPath</span> <span class="o">=</span> <span class="n">readString</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;abs_path&quot;</span><span class="p">)</span>
            <span class="n">repositoryDir</span><span class="o">.</span><span class="n">collectMode</span> <span class="o">=</span> <span class="n">readString</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;collect_mode&quot;</span><span class="p">)</span>
            <span class="n">repositoryDir</span><span class="o">.</span><span class="n">compressMode</span> <span class="o">=</span> <span class="n">readString</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;compress_mode&quot;</span><span class="p">)</span>
            <span class="p">(</span><span class="n">repositoryDir</span><span class="o">.</span><span class="n">relativeExcludePaths</span><span class="p">,</span> <span class="n">repositoryDir</span><span class="o">.</span><span class="n">excludePatterns</span><span class="p">)</span> <span class="o">=</span> <span class="n">LocalConfig</span><span class="o">.</span><span class="n">_parseExclusions</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
            <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">repositoryDir</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">lst</span> <span class="o">==</span> <span class="p">[]:</span>
         <span class="n">lst</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">return</span> <span class="n">lst</span>

   <span class="nd">@staticmethod</span>
   <span class="k">def</span> <span class="nf">_parseExclusions</span><span class="p">(</span><span class="n">parentNode</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Reads exclusions data from immediately beneath the parent.</span>

<span class="sd">      We read groups of the following items, one list element per item::</span>

<span class="sd">         relative    exclude/rel_path</span>
<span class="sd">         patterns    exclude/pattern</span>

<span class="sd">      If there are none of some pattern (i.e. no relative path items) then</span>
<span class="sd">      ``None`` will be returned for that item in the tuple.</span>

<span class="sd">      Args:</span>
<span class="sd">         parentNode: Parent node to search beneath</span>

<span class="sd">      Returns:</span>
<span class="sd">          Tuple of (relative, patterns) exclusions</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="n">section</span> <span class="o">=</span> <span class="n">readFirstChild</span><span class="p">(</span><span class="n">parentNode</span><span class="p">,</span> <span class="s2">&quot;exclude&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">section</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
         <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">relative</span> <span class="o">=</span> <span class="n">readStringList</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s2">&quot;rel_path&quot;</span><span class="p">)</span>
         <span class="n">patterns</span> <span class="o">=</span> <span class="n">readStringList</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s2">&quot;pattern&quot;</span><span class="p">)</span>
         <span class="k">return</span> <span class="p">(</span><span class="n">relative</span><span class="p">,</span> <span class="n">patterns</span><span class="p">)</span>

   <span class="nd">@staticmethod</span>
   <span class="k">def</span> <span class="nf">_addRepositoryDir</span><span class="p">(</span><span class="n">xmlDom</span><span class="p">,</span> <span class="n">parentNode</span><span class="p">,</span> <span class="n">repositoryDir</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Adds a repository dir container as the next child of a parent.</span>

<span class="sd">      We add the following fields to the document::</span>

<span class="sd">         repositoryType          repository_dir/type</span>
<span class="sd">         directoryPath           repository_dir/abs_path</span>
<span class="sd">         collectMode             repository_dir/collect_mode</span>
<span class="sd">         compressMode            repository_dir/compress_mode</span>

<span class="sd">      We also add groups of the following items, one list element per item::</span>

<span class="sd">         relativeExcludePaths    dir/exclude/rel_path</span>
<span class="sd">         excludePatterns         dir/exclude/pattern</span>

<span class="sd">      The &lt;repository_dir&gt; node itself is created as the next child of the</span>
<span class="sd">      parent node.  This method only adds one repository node.  The parent must</span>
<span class="sd">      loop for each repository dir in the ``SubversionConfig`` object.</span>

<span class="sd">      If ``repositoryDir`` is ``None``, this method call will be a no-op.</span>

<span class="sd">      Args:</span>
<span class="sd">         xmlDom: DOM tree as from ``impl.createDocument()``</span>
<span class="sd">         parentNode: Parent that the section should be appended to</span>
<span class="sd">         repositoryDir: Repository dir to be added to the document</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="n">repositoryDir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
         <span class="n">sectionNode</span> <span class="o">=</span> <span class="n">addContainerNode</span><span class="p">(</span><span class="n">xmlDom</span><span class="p">,</span> <span class="n">parentNode</span><span class="p">,</span> <span class="s2">&quot;repository_dir&quot;</span><span class="p">)</span>
         <span class="n">addStringNode</span><span class="p">(</span><span class="n">xmlDom</span><span class="p">,</span> <span class="n">sectionNode</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="n">repositoryDir</span><span class="o">.</span><span class="n">repositoryType</span><span class="p">)</span>
         <span class="n">addStringNode</span><span class="p">(</span><span class="n">xmlDom</span><span class="p">,</span> <span class="n">sectionNode</span><span class="p">,</span> <span class="s2">&quot;abs_path&quot;</span><span class="p">,</span> <span class="n">repositoryDir</span><span class="o">.</span><span class="n">directoryPath</span><span class="p">)</span>
         <span class="n">addStringNode</span><span class="p">(</span><span class="n">xmlDom</span><span class="p">,</span> <span class="n">sectionNode</span><span class="p">,</span> <span class="s2">&quot;collect_mode&quot;</span><span class="p">,</span> <span class="n">repositoryDir</span><span class="o">.</span><span class="n">collectMode</span><span class="p">)</span>
         <span class="n">addStringNode</span><span class="p">(</span><span class="n">xmlDom</span><span class="p">,</span> <span class="n">sectionNode</span><span class="p">,</span> <span class="s2">&quot;compress_mode&quot;</span><span class="p">,</span> <span class="n">repositoryDir</span><span class="o">.</span><span class="n">compressMode</span><span class="p">)</span>
         <span class="k">if</span> <span class="p">((</span><span class="n">repositoryDir</span><span class="o">.</span><span class="n">relativeExcludePaths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">repositoryDir</span><span class="o">.</span><span class="n">relativeExcludePaths</span> <span class="o">!=</span> <span class="p">[])</span> <span class="ow">or</span>
             <span class="p">(</span><span class="n">repositoryDir</span><span class="o">.</span><span class="n">excludePatterns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">repositoryDir</span><span class="o">.</span><span class="n">excludePatterns</span> <span class="o">!=</span> <span class="p">[])):</span>
            <span class="n">excludeNode</span> <span class="o">=</span> <span class="n">addContainerNode</span><span class="p">(</span><span class="n">xmlDom</span><span class="p">,</span> <span class="n">sectionNode</span><span class="p">,</span> <span class="s2">&quot;exclude&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">repositoryDir</span><span class="o">.</span><span class="n">relativeExcludePaths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
               <span class="k">for</span> <span class="n">relativePath</span> <span class="ow">in</span> <span class="n">repositoryDir</span><span class="o">.</span><span class="n">relativeExcludePaths</span><span class="p">:</span>
                  <span class="n">addStringNode</span><span class="p">(</span><span class="n">xmlDom</span><span class="p">,</span> <span class="n">excludeNode</span><span class="p">,</span> <span class="s2">&quot;rel_path&quot;</span><span class="p">,</span> <span class="n">relativePath</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">repositoryDir</span><span class="o">.</span><span class="n">excludePatterns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
               <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">repositoryDir</span><span class="o">.</span><span class="n">excludePatterns</span><span class="p">:</span>
                  <span class="n">addStringNode</span><span class="p">(</span><span class="n">xmlDom</span><span class="p">,</span> <span class="n">excludeNode</span><span class="p">,</span> <span class="s2">&quot;pattern&quot;</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span></div>


<span class="c1">########################################################################</span>
<span class="c1"># Public functions</span>
<span class="c1">########################################################################</span>

<span class="c1">###########################</span>
<span class="c1"># executeAction() function</span>
<span class="c1">###########################</span>

<div class="viewcode-block" id="executeAction"><a class="viewcode-back" href="../../../CedarBackup3.extend.html#CedarBackup3.extend.subversion.executeAction">[docs]</a><span class="k">def</span> <span class="nf">executeAction</span><span class="p">(</span><span class="n">configPath</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Executes the Subversion backup action.</span>

<span class="sd">   Args:</span>
<span class="sd">      configPath (String representing a path on disk): Path to configuration file on disk</span>
<span class="sd">      options (Options object): Program command-line options</span>
<span class="sd">      config (Config object): Program configuration</span>
<span class="sd">   Raises:</span>
<span class="sd">      ValueError: Under many generic error conditions</span>
<span class="sd">      IOError: If a backup could not be written for some reason</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Executing Subversion extended action.&quot;</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">options</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">config</span><span class="o">.</span><span class="n">collect</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cedar Backup configuration is not properly filled in.&quot;</span><span class="p">)</span>
   <span class="n">local</span> <span class="o">=</span> <span class="n">LocalConfig</span><span class="p">(</span><span class="n">xmlPath</span><span class="o">=</span><span class="n">configPath</span><span class="p">)</span>
   <span class="n">todayIsStart</span> <span class="o">=</span> <span class="n">isStartOfWeek</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">startingDay</span><span class="p">)</span>
   <span class="n">fullBackup</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">full</span> <span class="ow">or</span> <span class="n">todayIsStart</span>
   <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Full backup flag is [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">fullBackup</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">local</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">repositories</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">repository</span> <span class="ow">in</span> <span class="n">local</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">repositories</span><span class="p">:</span>
         <span class="n">_backupRepository</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">local</span><span class="p">,</span> <span class="n">todayIsStart</span><span class="p">,</span> <span class="n">fullBackup</span><span class="p">,</span> <span class="n">repository</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">local</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">repositoryDirs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">repositoryDir</span> <span class="ow">in</span> <span class="n">local</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">repositoryDirs</span><span class="p">:</span>
         <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Working with repository directory [</span><span class="si">%s</span><span class="s2">].&quot;</span><span class="p">,</span> <span class="n">repositoryDir</span><span class="o">.</span><span class="n">directoryPath</span><span class="p">)</span>
         <span class="k">for</span> <span class="n">repositoryPath</span> <span class="ow">in</span> <span class="n">_getRepositoryPaths</span><span class="p">(</span><span class="n">repositoryDir</span><span class="p">):</span>
            <span class="n">repository</span> <span class="o">=</span> <span class="n">Repository</span><span class="p">(</span><span class="n">repositoryDir</span><span class="o">.</span><span class="n">repositoryType</span><span class="p">,</span> <span class="n">repositoryPath</span><span class="p">,</span>
                                    <span class="n">repositoryDir</span><span class="o">.</span><span class="n">collectMode</span><span class="p">,</span> <span class="n">repositoryDir</span><span class="o">.</span><span class="n">compressMode</span><span class="p">)</span>
            <span class="n">_backupRepository</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">local</span><span class="p">,</span> <span class="n">todayIsStart</span><span class="p">,</span> <span class="n">fullBackup</span><span class="p">,</span> <span class="n">repository</span><span class="p">)</span>
         <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Completed backing up Subversion repository directory [</span><span class="si">%s</span><span class="s2">].&quot;</span><span class="p">,</span> <span class="n">repositoryDir</span><span class="o">.</span><span class="n">directoryPath</span><span class="p">)</span>
   <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Executed the Subversion extended action successfully.&quot;</span><span class="p">)</span></div>

<span class="k">def</span> <span class="nf">_getCollectMode</span><span class="p">(</span><span class="n">local</span><span class="p">,</span> <span class="n">repository</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Gets the collect mode that should be used for a repository.</span>
<span class="sd">   Use repository&#39;s if possible, otherwise take from subversion section.</span>
<span class="sd">   Args:</span>
<span class="sd">      repository: Repository object</span>
<span class="sd">   Returns:</span>
<span class="sd">       Collect mode to use</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="k">if</span> <span class="n">repository</span><span class="o">.</span><span class="n">collectMode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">collectMode</span> <span class="o">=</span> <span class="n">local</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">collectMode</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">collectMode</span> <span class="o">=</span> <span class="n">repository</span><span class="o">.</span><span class="n">collectMode</span>
   <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Collect mode is [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">collectMode</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">collectMode</span>

<span class="k">def</span> <span class="nf">_getCompressMode</span><span class="p">(</span><span class="n">local</span><span class="p">,</span> <span class="n">repository</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Gets the compress mode that should be used for a repository.</span>
<span class="sd">   Use repository&#39;s if possible, otherwise take from subversion section.</span>
<span class="sd">   Args:</span>
<span class="sd">      local: LocalConfig object</span>
<span class="sd">      repository: Repository object</span>
<span class="sd">   Returns:</span>
<span class="sd">       Compress mode to use</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="k">if</span> <span class="n">repository</span><span class="o">.</span><span class="n">compressMode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">compressMode</span> <span class="o">=</span> <span class="n">local</span><span class="o">.</span><span class="n">subversion</span><span class="o">.</span><span class="n">compressMode</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">compressMode</span> <span class="o">=</span> <span class="n">repository</span><span class="o">.</span><span class="n">compressMode</span>
   <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Compress mode is [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">compressMode</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">compressMode</span>

<span class="k">def</span> <span class="nf">_getRevisionPath</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">repository</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Gets the path to the revision file associated with a repository.</span>
<span class="sd">   Args:</span>
<span class="sd">      config: Config object</span>
<span class="sd">      repository: Repository object</span>
<span class="sd">   Returns:</span>
<span class="sd">       Absolute path to the revision file associated with the repository</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="n">normalized</span> <span class="o">=</span> <span class="n">buildNormalizedPath</span><span class="p">(</span><span class="n">repository</span><span class="o">.</span><span class="n">repositoryPath</span><span class="p">)</span>
   <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">normalized</span><span class="p">,</span> <span class="n">REVISION_PATH_EXTENSION</span><span class="p">)</span>
   <span class="n">revisionPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">workingDir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
   <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Revision file path is [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">revisionPath</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">revisionPath</span>

<span class="k">def</span> <span class="nf">_getBackupPath</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">repositoryPath</span><span class="p">,</span> <span class="n">compressMode</span><span class="p">,</span> <span class="n">startRevision</span><span class="p">,</span> <span class="n">endRevision</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Gets the backup file path (including correct extension) associated with a repository.</span>
<span class="sd">   Args:</span>
<span class="sd">      config: Config object</span>
<span class="sd">      repositoryPath: Path to the indicated repository</span>
<span class="sd">      compressMode: Compress mode to use for this repository</span>
<span class="sd">      startRevision: Starting repository revision</span>
<span class="sd">      endRevision: Ending repository revision</span>
<span class="sd">   Returns:</span>
<span class="sd">       Absolute path to the backup file associated with the repository</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="n">normalizedPath</span> <span class="o">=</span> <span class="n">buildNormalizedPath</span><span class="p">(</span><span class="n">repositoryPath</span><span class="p">)</span>
   <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;svndump-</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">-</span><span class="si">%s</span><span class="s2">.txt&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">startRevision</span><span class="p">,</span> <span class="n">endRevision</span><span class="p">,</span> <span class="n">normalizedPath</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">compressMode</span> <span class="o">==</span> <span class="s1">&#39;gzip&#39;</span><span class="p">:</span>
      <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.gz&quot;</span> <span class="o">%</span> <span class="n">filename</span>
   <span class="k">elif</span> <span class="n">compressMode</span> <span class="o">==</span> <span class="s1">&#39;bzip2&#39;</span><span class="p">:</span>
      <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.bz2&quot;</span> <span class="o">%</span> <span class="n">filename</span>
   <span class="n">backupPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">collect</span><span class="o">.</span><span class="n">targetDir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
   <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Backup file path is [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">backupPath</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">backupPath</span>

<span class="k">def</span> <span class="nf">_getRepositoryPaths</span><span class="p">(</span><span class="n">repositoryDir</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Gets a list of child repository paths within a repository directory.</span>
<span class="sd">   Args:</span>
<span class="sd">      repositoryDir: RepositoryDirectory</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="p">(</span><span class="n">excludePaths</span><span class="p">,</span> <span class="n">excludePatterns</span><span class="p">)</span> <span class="o">=</span> <span class="n">_getExclusions</span><span class="p">(</span><span class="n">repositoryDir</span><span class="p">)</span>
   <span class="n">fsList</span> <span class="o">=</span> <span class="n">FilesystemList</span><span class="p">()</span>
   <span class="n">fsList</span><span class="o">.</span><span class="n">excludeFiles</span> <span class="o">=</span> <span class="kc">True</span>
   <span class="n">fsList</span><span class="o">.</span><span class="n">excludeLinks</span> <span class="o">=</span> <span class="kc">True</span>
   <span class="n">fsList</span><span class="o">.</span><span class="n">excludePaths</span> <span class="o">=</span> <span class="n">excludePaths</span>
   <span class="n">fsList</span><span class="o">.</span><span class="n">excludePatterns</span> <span class="o">=</span> <span class="n">excludePatterns</span>
   <span class="n">fsList</span><span class="o">.</span><span class="n">addDirContents</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">repositoryDir</span><span class="o">.</span><span class="n">directoryPath</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">addSelf</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">fsList</span>

<span class="k">def</span> <span class="nf">_getExclusions</span><span class="p">(</span><span class="n">repositoryDir</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Gets exclusions (file and patterns) associated with an repository directory.</span>

<span class="sd">   The returned files value is a list of absolute paths to be excluded from the</span>
<span class="sd">   backup for a given directory.  It is derived from the repository directory&#39;s</span>
<span class="sd">   relative exclude paths.</span>

<span class="sd">   The returned patterns value is a list of patterns to be excluded from the</span>
<span class="sd">   backup for a given directory.  It is derived from the repository directory&#39;s</span>
<span class="sd">   list of patterns.</span>

<span class="sd">   Args:</span>
<span class="sd">      repositoryDir: Repository directory object</span>

<span class="sd">   Returns:</span>
<span class="sd">       Tuple (files, patterns) indicating what to exclude</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
   <span class="k">if</span> <span class="n">repositoryDir</span><span class="o">.</span><span class="n">relativeExcludePaths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">relativePath</span> <span class="ow">in</span> <span class="n">repositoryDir</span><span class="o">.</span><span class="n">relativeExcludePaths</span><span class="p">:</span>
         <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">repositoryDir</span><span class="o">.</span><span class="n">directoryPath</span><span class="p">,</span> <span class="n">relativePath</span><span class="p">))</span>
   <span class="n">patterns</span> <span class="o">=</span> <span class="p">[]</span>
   <span class="k">if</span> <span class="n">repositoryDir</span><span class="o">.</span><span class="n">excludePatterns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">patterns</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">repositoryDir</span><span class="o">.</span><span class="n">excludePatterns</span><span class="p">)</span>
   <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Exclude paths: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">paths</span><span class="p">)</span>
   <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Exclude patterns: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">patterns</span><span class="p">)</span>
   <span class="k">return</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">patterns</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_backupRepository</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">local</span><span class="p">,</span> <span class="n">todayIsStart</span><span class="p">,</span> <span class="n">fullBackup</span><span class="p">,</span> <span class="n">repository</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Backs up an individual Subversion repository.</span>

<span class="sd">   This internal method wraps the public methods and adds some functionality</span>
<span class="sd">   to work better with the extended action itself.</span>

<span class="sd">   Args:</span>
<span class="sd">      config: Cedar Backup configuration</span>
<span class="sd">      local: Local configuration</span>
<span class="sd">      todayIsStart: Indicates whether today is start of week</span>
<span class="sd">      fullBackup: Full backup flag</span>
<span class="sd">      repository: Repository to operate on</span>

<span class="sd">   Raises:</span>
<span class="sd">      ValueError: If some value is missing or invalid</span>
<span class="sd">      IOError: If there is a problem executing the Subversion dump</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Working with repository [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">repository</span><span class="o">.</span><span class="n">repositoryPath</span><span class="p">)</span>
   <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Repository type is [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">repository</span><span class="o">.</span><span class="n">repositoryType</span><span class="p">)</span>
   <span class="n">collectMode</span> <span class="o">=</span> <span class="n">_getCollectMode</span><span class="p">(</span><span class="n">local</span><span class="p">,</span> <span class="n">repository</span><span class="p">)</span>
   <span class="n">compressMode</span> <span class="o">=</span> <span class="n">_getCompressMode</span><span class="p">(</span><span class="n">local</span><span class="p">,</span> <span class="n">repository</span><span class="p">)</span>
   <span class="n">revisionPath</span> <span class="o">=</span> <span class="n">_getRevisionPath</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">repository</span><span class="p">)</span>
   <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">fullBackup</span> <span class="ow">or</span> <span class="p">(</span><span class="n">collectMode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;daily&#39;</span><span class="p">,</span> <span class="s1">&#39;incr&#39;</span><span class="p">,</span> <span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">collectMode</span> <span class="o">==</span> <span class="s1">&#39;weekly&#39;</span> <span class="ow">and</span> <span class="n">todayIsStart</span><span class="p">)):</span>
      <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Repository will not be backed up, per collect mode.&quot;</span><span class="p">)</span>
      <span class="k">return</span>
   <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Repository meets criteria to be backed up today.&quot;</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">collectMode</span> <span class="o">!=</span> <span class="s2">&quot;incr&quot;</span> <span class="ow">or</span> <span class="n">fullBackup</span><span class="p">:</span>
      <span class="n">startRevision</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="n">endRevision</span> <span class="o">=</span> <span class="n">getYoungestRevision</span><span class="p">(</span><span class="n">repository</span><span class="o">.</span><span class="n">repositoryPath</span><span class="p">)</span>
      <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using full backup, revision: (</span><span class="si">%d</span><span class="s2">, </span><span class="si">%d</span><span class="s2">).&quot;</span><span class="p">,</span> <span class="n">startRevision</span><span class="p">,</span> <span class="n">endRevision</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">fullBackup</span><span class="p">:</span>
         <span class="n">startRevision</span> <span class="o">=</span> <span class="mi">0</span>
         <span class="n">endRevision</span> <span class="o">=</span> <span class="n">getYoungestRevision</span><span class="p">(</span><span class="n">repository</span><span class="o">.</span><span class="n">repositoryPath</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">startRevision</span> <span class="o">=</span> <span class="n">_loadLastRevision</span><span class="p">(</span><span class="n">revisionPath</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
         <span class="n">endRevision</span> <span class="o">=</span> <span class="n">getYoungestRevision</span><span class="p">(</span><span class="n">repository</span><span class="o">.</span><span class="n">repositoryPath</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">startRevision</span> <span class="o">&gt;</span> <span class="n">endRevision</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No need to back up repository [</span><span class="si">%s</span><span class="s2">]; no new revisions.&quot;</span><span class="p">,</span> <span class="n">repository</span><span class="o">.</span><span class="n">repositoryPath</span><span class="p">)</span>
            <span class="k">return</span>
      <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using incremental backup, revision: (</span><span class="si">%d</span><span class="s2">, </span><span class="si">%d</span><span class="s2">).&quot;</span><span class="p">,</span> <span class="n">startRevision</span><span class="p">,</span> <span class="n">endRevision</span><span class="p">)</span>
   <span class="n">backupPath</span> <span class="o">=</span> <span class="n">_getBackupPath</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">repository</span><span class="o">.</span><span class="n">repositoryPath</span><span class="p">,</span> <span class="n">compressMode</span><span class="p">,</span> <span class="n">startRevision</span><span class="p">,</span> <span class="n">endRevision</span><span class="p">)</span>
   <span class="k">with</span> <span class="n">_getOutputFile</span><span class="p">(</span><span class="n">backupPath</span><span class="p">,</span> <span class="n">compressMode</span><span class="p">)</span> <span class="k">as</span> <span class="n">outputFile</span><span class="p">:</span>
      <span class="n">backupRepository</span><span class="p">(</span><span class="n">repository</span><span class="o">.</span><span class="n">repositoryPath</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">,</span> <span class="n">startRevision</span><span class="p">,</span> <span class="n">endRevision</span><span class="p">)</span>
   <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">backupPath</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Dump file [</span><span class="si">%s</span><span class="s2">] does not seem to exist after backup completed.&quot;</span> <span class="o">%</span> <span class="n">backupPath</span><span class="p">)</span>
   <span class="n">changeOwnership</span><span class="p">(</span><span class="n">backupPath</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">backupUser</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">backupGroup</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">collectMode</span> <span class="o">==</span> <span class="s2">&quot;incr&quot;</span><span class="p">:</span>
      <span class="n">_writeLastRevision</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">revisionPath</span><span class="p">,</span> <span class="n">endRevision</span><span class="p">)</span>
   <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Completed backing up Subversion repository [</span><span class="si">%s</span><span class="s2">].&quot;</span><span class="p">,</span> <span class="n">repository</span><span class="o">.</span><span class="n">repositoryPath</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_getOutputFile</span><span class="p">(</span><span class="n">backupPath</span><span class="p">,</span> <span class="n">compressMode</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Opens the output file used for saving the Subversion dump.</span>

<span class="sd">   If the compress mode is &quot;gzip&quot;, we&#39;ll open a ``GzipFile``, and if the</span>
<span class="sd">   compress mode is &quot;bzip2&quot;, we&#39;ll open a ``BZ2File``.  Otherwise, we&#39;ll just</span>
<span class="sd">   return an object from the normal ``open()`` method.</span>

<span class="sd">   Args:</span>
<span class="sd">      backupPath: Path to file to open</span>
<span class="sd">      compressMode: Compress mode of file (&quot;none&quot;, &quot;gzip&quot;, &quot;bzip&quot;)</span>

<span class="sd">   Returns:</span>
<span class="sd">       Output file object, opened in binary mode for use with executeCommand()</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="k">if</span> <span class="n">compressMode</span> <span class="o">==</span> <span class="s2">&quot;gzip&quot;</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">GzipFile</span><span class="p">(</span><span class="n">backupPath</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
   <span class="k">elif</span> <span class="n">compressMode</span> <span class="o">==</span> <span class="s2">&quot;bzip2&quot;</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">BZ2File</span><span class="p">(</span><span class="n">backupPath</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">backupPath</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_loadLastRevision</span><span class="p">(</span><span class="n">revisionPath</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Loads the indicated revision file from disk into an integer.</span>

<span class="sd">   If we can&#39;t load the revision file successfully (either because it doesn&#39;t</span>
<span class="sd">   exist or for some other reason), then a revision of -1 will be returned -</span>
<span class="sd">   but the condition will be logged.  This way, we err on the side of backing</span>
<span class="sd">   up too much, because anyone using this will presumably be adding 1 to the</span>
<span class="sd">   revision, so they don&#39;t duplicate any backups.</span>

<span class="sd">   Args:</span>
<span class="sd">      revisionPath: Path to the revision file on disk</span>

<span class="sd">   Returns:</span>
<span class="sd">       Integer representing last backed-up revision, -1 on error or if none can be read</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">revisionPath</span><span class="p">):</span>
      <span class="n">startRevision</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
      <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Revision file [</span><span class="si">%s</span><span class="s2">] does not exist on disk.&quot;</span><span class="p">,</span> <span class="n">revisionPath</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
         <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">revisionPath</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">startRevision</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">fix_imports</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># be compatible with Python 2</span>
         <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Loaded revision file [</span><span class="si">%s</span><span class="s2">] from disk: </span><span class="si">%d</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">revisionPath</span><span class="p">,</span> <span class="n">startRevision</span><span class="p">)</span>
      <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
         <span class="n">startRevision</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
         <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed loading revision file [</span><span class="si">%s</span><span class="s2">] from disk: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">revisionPath</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">startRevision</span>

<span class="k">def</span> <span class="nf">_writeLastRevision</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">revisionPath</span><span class="p">,</span> <span class="n">endRevision</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Writes the end revision to the indicated revision file on disk.</span>

<span class="sd">   If we can&#39;t write the revision file successfully for any reason, we&#39;ll log</span>
<span class="sd">   the condition but won&#39;t throw an exception.</span>

<span class="sd">   Args:</span>
<span class="sd">      config: Config object</span>
<span class="sd">      revisionPath: Path to the revision file on disk</span>
<span class="sd">      endRevision: Last revision backed up on this run</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="k">try</span><span class="p">:</span>
      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">revisionPath</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
         <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">endRevision</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fix_imports</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="n">changeOwnership</span><span class="p">(</span><span class="n">revisionPath</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">backupUser</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">backupGroup</span><span class="p">)</span>
      <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Wrote new revision file [</span><span class="si">%s</span><span class="s2">] to disk: </span><span class="si">%d</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">revisionPath</span><span class="p">,</span> <span class="n">endRevision</span><span class="p">)</span>
   <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to write revision file [</span><span class="si">%s</span><span class="s2">] to disk: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">revisionPath</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>


<span class="c1">##############################</span>
<span class="c1"># backupRepository() function</span>
<span class="c1">##############################</span>

<div class="viewcode-block" id="backupRepository"><a class="viewcode-back" href="../../../CedarBackup3.extend.html#CedarBackup3.extend.subversion.backupRepository">[docs]</a><span class="k">def</span> <span class="nf">backupRepository</span><span class="p">(</span><span class="n">repositoryPath</span><span class="p">,</span> <span class="n">backupFile</span><span class="p">,</span> <span class="n">startRevision</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endRevision</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Backs up an individual Subversion repository.</span>

<span class="sd">   The starting and ending revision values control an incremental backup.  If</span>
<span class="sd">   the starting revision is not passed in, then revision zero (the start of the</span>
<span class="sd">   repository) is assumed.  If the ending revision is not passed in, then the</span>
<span class="sd">   youngest revision in the database will be used as the endpoint.</span>

<span class="sd">   The backup data will be written into the passed-in back file.  Normally,</span>
<span class="sd">   this would be an object as returned from ``open``, but it is possible to use</span>
<span class="sd">   something like a ``GzipFile`` to write compressed output.  The caller is</span>
<span class="sd">   responsible for closing the passed-in backup file.</span>

<span class="sd">   *Note:* This function should either be run as root or as the owner of the</span>
<span class="sd">   Subversion repository.</span>

<span class="sd">   *Note:* It is apparently *not* a good idea to interrupt this function.</span>
<span class="sd">   Sometimes, this leaves the repository in a &quot;wedged&quot; state, which requires</span>
<span class="sd">   recovery using ``svnadmin recover``.</span>

<span class="sd">   Args:</span>
<span class="sd">      repositoryPath (String path representing Subversion repository on disk): Path to Subversion repository to back up</span>
<span class="sd">      backupFile (Python file object as from ``open`` or ``file``): Python file object to use for writing backup</span>
<span class="sd">      startRevision (Integer value &gt;= 0): Starting repository revision to back up (for incremental backups)</span>
<span class="sd">      endRevision (Integer value &gt;= 0): Ending repository revision to back up (for incremental backups)</span>
<span class="sd">   Raises:</span>
<span class="sd">      ValueError: If some value is missing or invalid</span>
<span class="sd">      IOError: If there is a problem executing the Subversion dump</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="k">if</span> <span class="n">startRevision</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">startRevision</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="n">endRevision</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">endRevision</span> <span class="o">=</span> <span class="n">getYoungestRevision</span><span class="p">(</span><span class="n">repositoryPath</span><span class="p">)</span>
   <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">startRevision</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Start revision must be &gt;= 0.&quot;</span><span class="p">)</span>
   <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">endRevision</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;End revision must be &gt;= 0.&quot;</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">startRevision</span> <span class="o">&gt;</span> <span class="n">endRevision</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Start revision must be &lt;= end revision.&quot;</span><span class="p">)</span>
   <span class="n">args</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;dump&quot;</span><span class="p">,</span> <span class="s2">&quot;--quiet&quot;</span><span class="p">,</span> <span class="s2">&quot;-r</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">startRevision</span><span class="p">,</span> <span class="n">endRevision</span><span class="p">),</span> <span class="s2">&quot;--incremental&quot;</span><span class="p">,</span> <span class="n">repositoryPath</span><span class="p">,</span> <span class="p">]</span>
   <span class="n">command</span> <span class="o">=</span> <span class="n">resolveCommand</span><span class="p">(</span><span class="n">SVNADMIN_COMMAND</span><span class="p">)</span>
   <span class="n">result</span> <span class="o">=</span> <span class="n">executeCommand</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">returnOutput</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ignoreStderr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">doNotLog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">outputFile</span><span class="o">=</span><span class="n">backupFile</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
   <span class="k">if</span> <span class="n">result</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Error [</span><span class="si">%d</span><span class="s2">] executing Subversion dump for repository [</span><span class="si">%s</span><span class="s2">].&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">repositoryPath</span><span class="p">))</span>
   <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Completed dumping subversion repository [</span><span class="si">%s</span><span class="s2">].&quot;</span><span class="p">,</span> <span class="n">repositoryPath</span><span class="p">)</span></div>


<span class="c1">#################################</span>
<span class="c1"># getYoungestRevision() function</span>
<span class="c1">#################################</span>

<div class="viewcode-block" id="getYoungestRevision"><a class="viewcode-back" href="../../../CedarBackup3.extend.html#CedarBackup3.extend.subversion.getYoungestRevision">[docs]</a><span class="k">def</span> <span class="nf">getYoungestRevision</span><span class="p">(</span><span class="n">repositoryPath</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Gets the youngest (newest) revision in a Subversion repository using ``svnlook``.</span>

<span class="sd">   *Note:* This function should either be run as root or as the owner of the</span>
<span class="sd">   Subversion repository.</span>

<span class="sd">   Args:</span>
<span class="sd">      repositoryPath (String path representing Subversion repository on disk): Path to Subversion repository to look in</span>
<span class="sd">   Returns:</span>
<span class="sd">       Youngest revision as an integer</span>

<span class="sd">   Raises:</span>
<span class="sd">      ValueError: If there is a problem parsing the ``svnlook`` output</span>
<span class="sd">      IOError: If there is a problem executing the ``svnlook`` command</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="n">args</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;youngest&#39;</span><span class="p">,</span> <span class="n">repositoryPath</span><span class="p">,</span> <span class="p">]</span>
   <span class="n">command</span> <span class="o">=</span> <span class="n">resolveCommand</span><span class="p">(</span><span class="n">SVNLOOK_COMMAND</span><span class="p">)</span>
   <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span> <span class="o">=</span> <span class="n">executeCommand</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">returnOutput</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ignoreStderr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">result</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Error [</span><span class="si">%d</span><span class="s2">] executing &#39;svnlook youngest&#39; for repository [</span><span class="si">%s</span><span class="s2">].&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">repositoryPath</span><span class="p">))</span>
   <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unable to parse &#39;svnlook youngest&#39; output.&quot;</span><span class="p">)</span>
   <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<span class="c1">########################################################################</span>
<span class="c1"># Deprecated functionality</span>
<span class="c1">########################################################################</span>

<div class="viewcode-block" id="BDBRepository"><a class="viewcode-back" href="../../../CedarBackup3.extend.html#CedarBackup3.extend.subversion.BDBRepository">[docs]</a><span class="k">class</span> <span class="nc">BDBRepository</span><span class="p">(</span><span class="n">Repository</span><span class="p">):</span>

   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Class representing Subversion BDB (Berkeley Database) repository configuration.</span>
<span class="sd">   This object is deprecated.  Use a simple :any:`Repository` instead.</span>
<span class="sd">   &quot;&quot;&quot;</span>

<div class="viewcode-block" id="BDBRepository.__init__"><a class="viewcode-back" href="../../../CedarBackup3.extend.html#CedarBackup3.extend.subversion.BDBRepository.__init__">[docs]</a>   <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repositoryPath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">collectMode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compressMode</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Constructor for the ``BDBRepository`` class.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="nb">super</span><span class="p">(</span><span class="n">BDBRepository</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;BDB&quot;</span><span class="p">,</span> <span class="n">repositoryPath</span><span class="p">,</span> <span class="n">collectMode</span><span class="p">,</span> <span class="n">compressMode</span><span class="p">)</span></div>

   <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Official string representation for class instance.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="s2">&quot;BDBRepository(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repositoryPath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectMode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compressMode</span><span class="p">)</span></div>


<div class="viewcode-block" id="FSFSRepository"><a class="viewcode-back" href="../../../CedarBackup3.extend.html#CedarBackup3.extend.subversion.FSFSRepository">[docs]</a><span class="k">class</span> <span class="nc">FSFSRepository</span><span class="p">(</span><span class="n">Repository</span><span class="p">):</span>

   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Class representing Subversion FSFS repository configuration.</span>
<span class="sd">   This object is deprecated.  Use a simple :any:`Repository` instead.</span>
<span class="sd">   &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FSFSRepository.__init__"><a class="viewcode-back" href="../../../CedarBackup3.extend.html#CedarBackup3.extend.subversion.FSFSRepository.__init__">[docs]</a>   <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repositoryPath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">collectMode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compressMode</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Constructor for the ``FSFSRepository`` class.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="nb">super</span><span class="p">(</span><span class="n">FSFSRepository</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;FSFS&quot;</span><span class="p">,</span> <span class="n">repositoryPath</span><span class="p">,</span> <span class="n">collectMode</span><span class="p">,</span> <span class="n">compressMode</span><span class="p">)</span></div>

   <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Official string representation for class instance.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="s2">&quot;FSFSRepository(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repositoryPath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectMode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compressMode</span><span class="p">)</span></div>


<div class="viewcode-block" id="backupBDBRepository"><a class="viewcode-back" href="../../../CedarBackup3.extend.html#CedarBackup3.extend.subversion.backupBDBRepository">[docs]</a><span class="k">def</span> <span class="nf">backupBDBRepository</span><span class="p">(</span><span class="n">repositoryPath</span><span class="p">,</span> <span class="n">backupFile</span><span class="p">,</span> <span class="n">startRevision</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endRevision</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Backs up an individual Subversion BDB repository.</span>
<span class="sd">   This function is deprecated.  Use :any:`backupRepository` instead.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="k">return</span> <span class="n">backupRepository</span><span class="p">(</span><span class="n">repositoryPath</span><span class="p">,</span> <span class="n">backupFile</span><span class="p">,</span> <span class="n">startRevision</span><span class="p">,</span> <span class="n">endRevision</span><span class="p">)</span></div>


<div class="viewcode-block" id="backupFSFSRepository"><a class="viewcode-back" href="../../../CedarBackup3.extend.html#CedarBackup3.extend.subversion.backupFSFSRepository">[docs]</a><span class="k">def</span> <span class="nf">backupFSFSRepository</span><span class="p">(</span><span class="n">repositoryPath</span><span class="p">,</span> <span class="n">backupFile</span><span class="p">,</span> <span class="n">startRevision</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endRevision</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Backs up an individual Subversion FSFS repository.</span>
<span class="sd">   This function is deprecated.  Use :any:`backupRepository` instead.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="k">return</span> <span class="n">backupRepository</span><span class="p">(</span><span class="n">repositoryPath</span><span class="p">,</span> <span class="n">backupFile</span><span class="p">,</span> <span class="n">startRevision</span><span class="p">,</span> <span class="n">endRevision</span><span class="p">)</span></div>

</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Cedar Backup v3  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright .
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.9.
    </div>
  </body>
</html>
